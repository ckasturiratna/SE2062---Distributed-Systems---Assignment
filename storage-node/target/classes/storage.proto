syntax = "proto3";

package storage;

option java_multiple_files = true;
option java_package = "com.distributed.filestorage.storage.grpc";
option java_outer_classname = "StorageProto";

service StorageService {
  // Store a file chunk
  rpc StoreChunk(StoreChunkRequest) returns (StoreChunkResponse);
  
  // Retrieve a file chunk
  rpc RetrieveChunk(RetrieveChunkRequest) returns (RetrieveChunkResponse);
  
  // Delete a file chunk
  rpc DeleteChunk(DeleteChunkRequest) returns (DeleteChunkResponse);
  
  // List stored chunks
  rpc ListChunks(ListChunksRequest) returns (ListChunksResponse);
  
  // Health check
  rpc HealthCheck(HealthCheckRequest) returns (HealthCheckResponse);
  
  // Replicate chunk to other nodes
  rpc ReplicateChunk(ReplicationRequest) returns (ReplicationResponse);
}

message StoreChunkRequest {
  string file_id = 1;
  int32 chunk_index = 2;
  bytes data = 3;
  string checksum = 4;
  int32 replication_factor = 5;
}

message StoreChunkResponse {
  bool success = 1;
  string message = 2;
  string chunk_id = 3;
}

message RetrieveChunkRequest {
  string file_id = 1;
  int32 chunk_index = 2;
}

message RetrieveChunkResponse {
  bool success = 1;
  string message = 2;
  bytes data = 3;
  string checksum = 4;
}

message DeleteChunkRequest {
  string file_id = 1;
  int32 chunk_index = 2;
}

message DeleteChunkResponse {
  bool success = 1;
  string message = 2;
}

message ListChunksRequest {
  string file_id = 1; // Optional: filter by file ID
}

message ListChunksResponse {
  repeated ChunkInfo chunks = 1;
}

message ChunkInfo {
  string file_id = 1;
  int32 chunk_index = 2;
  string chunk_id = 3;
  int64 size = 4;
  string checksum = 5;
  int64 created_at = 6;
}

message HealthCheckRequest {
}

message HealthCheckResponse {
  bool healthy = 1;
  string node_id = 2;
  double load_factor = 3;
  int64 available_space = 4;
}

message ReplicationRequest {
  string file_id = 1;
  int32 chunk_index = 2;
  bytes data = 3;
  string checksum = 4;
  string source_node_id = 5;
}

message ReplicationResponse {
  bool success = 1;
  string message = 2;
}